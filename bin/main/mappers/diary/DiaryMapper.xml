<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.codemoa.project.domain.diary.mapper.DiaryMapper">

<!-- 
	===============================
	    Project 관련
	===============================
-->
	<select id="getProjectList" resultType="Project">
		SELECT * FROM project WHERE user_id=#{userID} ORDER BY project_id DESC
	</select>
	
	<select id="searchProjectList" resultType="Project">
		SELECT * FROM project
		WHERE user_id=#{userId} AND name LIKE CONCAT('%', #{keyword}, '%')
		ORDER BY project_id DESC
	</select>
	
	<select id="getProjectDetail" resultType="Project">
		SELECT * FROM project WHERE project_id=#{projectId}
	</select>
	
	<insert id="addProject" parameterType="SaveProjectRequest">
		INSERT INTO project (user_id, name, description, status) VALUES (#{userId}, #{name}, #{description}, #{status});
	</insert>
	
	<update id="updateProject" parameterType="SaveProjectRequest">
		UPDATE project SET name=#{name}, description=#{description}, status=#{status} WHERE project_id=#{projectId}
	</update>
	
	<delete id="deleteProject">
		DELETE FROM project WHERE project_id=#{projectId}
	</delete>
	
<!-- 
	===============================
	    ProjectChecklist 관련
	===============================
-->
	<select id="getProjectCheckList" resultType="ProjectChecklist">
	    SELECT checklist_id,
	           project_id,
	           content,
	           is_done AS done,
	           priority,
	           created_at
	    FROM project_checklist
	    WHERE project_id = #{projectId}
	    ORDER BY checklist_id
	</select>
	
	<update id="updateCheck" parameterType="UpdateCheckStatusRequest">
		UPDATE project_checklist SET is_done=#{done} WHERE checklist_id=#{no}
	</update>
	
	<insert id="addChecklist" parameterType="CreateChecklistRequest" 
		useGeneratedKeys="true" keyProperty="checklistId">
		INSERT INTO project_checklist (project_id, content, is_done, priority) 
		VALUES (#{projectId}, #{content}, 0, #{priority});
    </insert>
    
    <select id="getNewProjectCheckList" parameterType="ProjectChecklist">
	    SELECT checklist_id,
	           project_id,
	           content,
	           is_done AS done,
	           priority,
	           created_at
	    FROM project_checklist
	    WHERE checklist_id = #{checklist_id}
    </select>
	
	<update id="updateChecklist" parameterType="UpdateChecklistRequest">
		UPDATE project_checklist SET content=#{content}, priority=#{priority} WHERE checklist_id=#{checklistId}
	</update>
	
	<delete id="deleteChecklist">
		DELETE FROM project_checklist WHERE checklist_id=#{checklistId};
	</delete>


<!-- 
	===============================
	    ProjectDiary 관련
	===============================
-->
	<select id="getProjectdiaries" resultType="ProjectDiary">
		SELECT * FROM project_diary WHERE project_id=#{projectId} ORDER BY diary_id DESC;
	</select>
	
	<insert id="addDiary" parameterType="SaveDiaryRequest"
		useGeneratedKeys="true" keyProperty="diaryId">
		INSERT INTO project_diary (project_id, work_date, content) VALUES (#{projectId}, #{workDate}, #{content});
	</insert>
	
	<update id="updateDiary" parameterType="SaveDiaryRequest">
		UPDATE project_diary SET work_date=#{workDate}, content=#{content} WHERE diary_id=#{diaryId}  
	</update>
	
	<select id="getDiary" resultType="ProjectDiary">
		SELECT * FROM project_diary WHERE diary_id=#{diaryId}
	</select>
	
	<delete id="deleteDiary">
		DELETE FROM project_diary WHERE diary_id=#{diaryId}
	</delete>
</mapper>