<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/default_layout}">
	
<head>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>  
	<link th:href="@{/css/information/listLayout4.css}" rel="stylesheet" />
</head>

<th:block layout:fragment="content">
	<style>
		/* AI 웹 퍼블리셔: Swiper 컨테이너에 padding을 추가하여 그림자가 잘리지 않도록 공간을 확보합니다. */
		.mySwiper {
			padding-top: 10px;
			padding-bottom: 30px;
		}

		.book-gallery-card {
			background-color: white;
			border-radius: var(--bs-border-radius);
			box-shadow: var(--bs-box-shadow-sm);
			height: 100%;
			display: flex;
			flex-direction: column;
			transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
		}
		.book-gallery-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
		}

		/* AI 웹 퍼블리셔: object-fit을 'contain'으로 변경하여 이미지가 잘리지 않고 전체가 보이도록 수정 */
		.book-cover-image {
			width: 100%;
			height: 250px;
			object-fit: contain; 
		}

		.book-texts {
			padding: 1rem;
			flex-grow: 1;
			display: flex;
			flex-direction: column;
		}
		.book-texts strong {
			font-weight: 700;
			display: -webkit-box;
			-webkit-line-clamp: 2;
			-webkit-box-orient: vertical;
			overflow: hidden;
			text-overflow: ellipsis;
			min-height: 2.5em; 
			flex-grow: 1; 
		}
		.book-texts .metadata {
			font-size: 0.85rem;
			color: #495057;
			margin-top: 0.75rem;
		}
		.book-texts .metadata span {
			display: block;
		}
		
		.book-hover-overlay {
			position: absolute; top: 0; left: 0; width: 100%; height: 100%;
			background-color: rgba(33, 37, 41, 0.7);
			color: white;
			padding: 1.5rem;
			opacity: 0;
			transition: opacity 0.3s ease;
			display: flex; align-items: center; justify-content: center; text-align: center;
		}
		.book-gallery-card a:hover .book-hover-overlay {
			opacity: 1;
		}
		.book-hover-content {
			font-size: 0.9rem;
			display: -webkit-box;
			-webkit-line-clamp: 10;
			-webkit-box-orient: vertical;
			overflow: hidden;
		}
	</style>
	
	<main class="container my-5">
		<div class="text-center mb-4">
			<h2 class="fw-bold fs-2">IT 도서 추천</h2>
		</div>

		<div class="d-flex justify-content-end align-items-center mb-4">
			<div class="d-flex align-items-center gap-2">
				<form class="d-flex" role="search" id="bookSearchForm">
					<input class="form-control" type="search" name="keyword" 
					       placeholder="도서명 검색" style="min-width: 200px;" id="bookSearch"
					       th:value="${#strings.isEmpty(keyword) or keyword == 'null' ? '' : keyword}" />
					<input type="hidden" name="type" id="type">
				</form>
				<th:block th:if="${order =='pubDate'}">
					<select name="order" id="typeSelector3" class="form-select">
						<option value="bookNo">기존 순서</option>
						<option value="pubDate" selected>출판일</option>
						<option value="rating">평점</option>
					</select>
				</th:block>
				<th:block th:if="${order =='rating'}">
					<select name="order" id="typeSelector3" class="form-select">
						<option value="bookNo">기존 순서</option>
						<option value="pubDate">출판일</option>
						<option value="rating" selected>평점</option>
					</select>
				</th:block>
				<th:block th:if="${order !='pubDate' and order !='rating'}">
					<select name="order" id="typeSelector3" class="form-select">
						<option value="bookNo" disabled selected>정렬기준</option>
						<option value="bookNo">기존 순서</option>
						<option value="pubDate">출판일</option>
						<option value="rating">평점</option>
					</select>
				</th:block>
				<a th:href="@{bookAdd}" class="btn btn-primary flex-shrink-0">글쓰기</a>
			</div>
		</div>

		<div class="swiper mySwiper">
			<div class="swiper-wrapper" id="content">
		
				<th:block th:each="book: ${bList}">
					<div class="swiper-slide">
						<div class="book-gallery-card">
							<a th:href="@{/information/bookDetail(no=${book.bookNo}, pageNum=${currentPage}, order=${order}, type=${type}, keyword=${keyword})}">
								<img th:src="@{/files/information/{img}(img=${book.file1})}" alt="이미지" class="book-cover-image">
								<div class="book-hover-overlay">
									<div class="book-hover-content">
										[[${book.content}]]
									</div>
								</div>
							</a>
							<div class="book-texts">
								<strong>[[${book.title}]]</strong>
								<div class="metadata">
									<span><b class="fw-bold">출판일:</b> [[${#dates.format(book.pubDate, 'yyyy-MM-dd')}]]</span>
									<span><b class="fw-bold">평점:</b> [[${book.rating}]]</span>
								</div>
							</div>
						</div>
					</div>
				</th:block>
				
			</div>
		</div>

		<div class="row mt-5" id="Row">
			<div class="col">
				<nav th:if="${order != null and not #lists.isEmpty(bList)}" aria-label="Page navigation">
					<ul class="pagination justify-content-center">
						<li class="page-item" th:if="${startPage > pageGroup}"><a class="page-link" th:href="@{|book?pageNum=${startPage-1}&order=${order}&keyword=${keyword}|}">Pre</a></li>
						<li th:each="num : ${#numbers.sequence(startPage, endPage)}" th:classappend="${num == currentPage} ? 'active'" class="page-item"><a class="page-link" th:href="@{|book?pageNum=${num}&order=${order}&keyword=${keyword}|}" th:text="${num}"></a></li>
						<li class="page-item" th:if="${endPage < pageCount}"><a class="page-link" th:href="@{|book?pageNum=${startPage+pageGroup}&order=${order}&keyword=${keyword}|}">Next</a></li>
					</ul>
				</nav>
				<nav th:if="${order == null and not #lists.isEmpty(bList)}" aria-label="Page navigation">
					<ul class="pagination justify-content-center">
						<li class="page-item" th:if="${startPage > pageGroup}"><a class="page-link" th:href="@{|book?pageNum=${startPage-1}&keyword=${keyword}|}">Pre</a></li>
						<li th:each="num : ${#numbers.sequence(startPage, endPage)}" th:classappend="${num == currentPage} ? 'active'" class="page-item"><a class="page-link" th:href="@{|book?pageNum=${num}&keyword=${keyword}|}" th:text="${num}"></a></li>
						<li class="page-item" th:if="${endPage < pageCount}"><a class="page-link" th:href="@{|book?pageNum=${startPage+pageGroup}&keyword=${keyword}|}">Next</a></li>
					</ul>
				</nav>
			</div>
		</div>
	</main>
</th:block>

<th:block layout:fragment="script">
	<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
	<script th:src="@{/js/information/ajax.js}"></script>
	<script>
		const swiper = new Swiper(".mySwiper", {
			slidesPerView: 1,
			spaceBetween: 30,
			grid: {
				rows: 2,
				fill: "row",
			},
			breakpoints: {
				576: { slidesPerView: 2, grid: { rows: 2, fill: "row" } },
				768: { slidesPerView: 3, grid: { rows: 2, fill: "row" } },
				992: { slidesPerView: 4, grid: { rows: 2, fill: "row" } }
			}
		});
	</script>
</th:block>
	
</html>