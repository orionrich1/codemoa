<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
      layout:decorate="~{layouts/default_layout}">

<div layout:fragment="content">
    <style>
        @media (max-width: 767px) {
            .responsive-table, .responsive-table thead, .responsive-table tbody, .responsive-table th, .responsive-table td, .responsive-table tr { display: block; }
            .responsive-table thead { display: none; }
            .responsive-table tr {
                border: 1px solid #e9ecef; border-radius: var(--bs-border-radius); margin-bottom: 1rem; padding: 1.25rem;
                display: grid; grid-template-columns: 1fr auto; grid-template-rows: auto auto; gap: 0.5rem; align-items: center;
            }
            .responsive-table .td-title { grid-column: 1 / 3; grid-row: 1; margin-bottom: 0.5rem; }
            .responsive-table .td-title a { font-size: 1.1rem; font-weight: 800; line-height: 1.4; }
            .responsive-table .td-author { grid-column: 1; grid-row: 2; font-size: 0.9rem; color: #495057; }
            .responsive-table .td-author .d-flex { justify-content: flex-start !important; }
            .responsive-table .td-category { grid-column: 2; grid-row: 2; justify-self: end; }
            .responsive-table .td-no, .responsive-table .td-date { display: none; }
            .responsive-table td { border: none; padding: 0 !important; }
            .responsive-table td:before { display: none; }
        }
    </style>

    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="text-center mb-4">
                    <h2 class="fw-bold fs-2" th:text="${categoryName}">게시판</h2>
                </div>
                <div class="card shadow-sm border-0">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-end mb-3">
                            <a th:href="@{/boards/write(category=${category})}" class="btn btn-primary"><i class="bi bi-pencil-square me-2"></i>글쓰기</a>
                        </div>
                        <div class="table-responsive-container">
                            <table class="table table-hover align-middle responsive-table">
                                <thead class="table-light">
                                    <tr>
                                        <th class="text-center d-none d-md-table-cell" style="width: 10%;">번호</th>
                                        <th class="text-center" style="width: 15%;">카테고리</th>
                                        <th>제목</th>
                                        <th class="text-center" style="width: 15%;">작성자</th>
                                        <th class="text-center d-none d-md-table-cell" style="width: 15%;">작성일</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="board : ${boards.content}">
                                        <td class="td-no text-center d-none d-md-table-cell" th:text="${board.boardNo}">1</td>
                                        <td class="td-category text-center">
                                            <span class="badge rounded-pill text-bg-secondary" th:text="${board.category}">Java</span>
                                        </td>
                                        <td class="td-title">
                                            <a class="text-dark text-decoration-none" th:href="@{/boards/{boardNo}(boardNo=${board.boardNo})}">
                                                [[${board.title}]]
                                            </a>
                                            <span class="badge bg-primary ms-2" th:if="${board.stakedPoints > 0}" th:text="|${board.stakedPoints}P|"></span>
                                        </td>
                                        <td class="td-author text-center">
                                            <div class="d-flex justify-content-center">
                                                <div th:replace="~{fragments/_userProfile :: userProfile(nickname=${board.authorNickname}, iconName=${board.authorGradeIconName})}"></div>
                                            </div>
                                        </td>
                                        <td class="td-date text-center d-none d-md-table-cell" th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd')}">2025-07-28</td>
                                    </tr>
                                    <tr th:if="${boards.empty}">
                                        <td colspan="5" class="text-center py-5 text-secondary">조회된 게시글이 없습니다.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div th:if="${!boards.empty}" class="mt-4">
                            <nav aria-label="Page navigation">
                                <ul class="pagination justify-content-center mb-0">
                                    <li class="page-item" th:classappend="${startPage == 1} ? 'disabled'"><a class="page-link" th:href="@{/community/{category}(category=${category}, page=${startPage - 2}, searchType=${searchType}, keyword=${keyword})}">이전</a></li>
                                    <li class="page-item" th:each="page: ${#numbers.sequence(startPage, endPage)}" th:classappend="${page == nowPage} ? 'active'"><a class="page-link" th:text="${page}" th:href="@{/community/{category}(category=${category}, page=${page - 1}, searchType=${searchType}, keyword=${keyword})}"></a></li>
                                    <li class="page-item" th:classappend="${endPage >= boards.totalPages} ? 'disabled'"><a class="page-link" th:href="@{/community/{category}(category=${category}, page=${endPage}, searchType=${searchType}, keyword=${keyword})}">다음</a></li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                    <div class="card-footer bg-light p-3">
                        <form th:action="@{/community/{category}(category=${category})}" method="get" class="d-flex justify-content-center flex-wrap gap-2">
                            <div style="width: 150px;"><select name="searchType" class="form-select"><option value="title_content" th:selected="${searchType == 'title_content'}">제목+내용</option><option value="title" th:selected="${searchType == 'title'}">제목</option><option value="content" th:selected="${searchType == 'content'}">내용</option><option value="author" th:selected="${searchType == 'author'}">작성자</option></select></div>
                            <div class="flex-grow-1" style="min-width: 200px;"><input type="text" name="keyword" class="form-control" th:value="${keyword}" placeholder="검색어를 입력하세요"></div>
                            <div><button type="submit" class="btn btn-primary">검색</button></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</html>